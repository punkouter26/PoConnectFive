flowchart TD
    Start([User Starts Game]) --> SelectMode{Select<br/>Game Mode?}

    SelectMode -->|Player vs Player| SetupPvP[Set Player Names]
    SelectMode -->|Player vs AI| SetupPvAI[Set Player Name &<br/>AI Difficulty]

    SetupPvP --> InitGame[Initialize Game Board]
    SetupPvAI --> InitGame

    InitGame --> StartTimer[Start Game Timer]
    StartTimer --> Player1Turn{Player 1's Turn}

    Player1Turn --> SelectColumn1[Select Column to<br/>Drop Piece]
    SelectColumn1 --> ValidMove1{Valid<br/>Move?}

    ValidMove1 -->|No| FullColumn1[Show 'Column Full'<br/>Message]
    FullColumn1 --> Player1Turn

    ValidMove1 -->|Yes| PlacePiece1[Place Piece<br/>on Board]
    PlacePiece1 --> PlaySound1[Play Drop<br/>Sound Effect]
    PlaySound1 --> CheckWin1{Check for<br/>Win?}

    CheckWin1 -->|Win!| Player1Wins[Player 1 Wins!]
    CheckWin1 -->|No Win| CheckDraw1{Board<br/>Full?}

    CheckDraw1 -->|Yes| GameDraw[Game Draw!]
    CheckDraw1 -->|No| SwitchToP2[Switch to<br/>Player 2]

    SwitchToP2 --> Player2Turn{Player 2's Turn<br/>or AI?}

    Player2Turn -->|Human Player| SelectColumn2[Select Column to<br/>Drop Piece]
    Player2Turn -->|AI Player| AICalculate[AI Calculates<br/>Best Move]

    AICalculate --> AIDepth{AI<br/>Difficulty?}
    AIDepth -->|Easy| RandomMove[Random Valid<br/>Column]
    AIDepth -->|Medium| DefensiveMove[Block Player<br/>or Random]
    AIDepth -->|Hard| MinimaxMove[Minimax Algorithm<br/>Depth 4]

    RandomMove --> PlacePiece2
    DefensiveMove --> PlacePiece2
    MinimaxMove --> PlacePiece2

    SelectColumn2 --> ValidMove2{Valid<br/>Move?}
    ValidMove2 -->|No| FullColumn2[Show 'Column Full'<br/>Message]
    FullColumn2 --> SelectColumn2

    ValidMove2 -->|Yes| PlacePiece2[Place Piece<br/>on Board]
    PlacePiece2 --> PlaySound2[Play Drop<br/>Sound Effect]
    PlaySound2 --> CheckWin2{Check for<br/>Win?}

    CheckWin2 -->|Win!| Player2Wins[Player 2/AI Wins!]
    CheckWin2 -->|No Win| CheckDraw2{Board<br/>Full?}

    CheckDraw2 -->|Yes| GameDraw
    CheckDraw2 -->|No| Player1Turn

    Player1Wins --> StopTimer[Stop Game Timer]
    Player2Wins --> StopTimer
    GameDraw --> StopTimer

    StopTimer --> ShowResults[Display Final<br/>Results Screen]
    ShowResults --> PlayVictorySound[Play Victory/<br/>Draw Sound]

    PlayVictorySound --> SaveStats[Save Player Stats<br/>to Database]
    SaveStats --> UpdateLeaderboard[Update Leaderboard<br/>Rankings]

    UpdateLeaderboard --> TrackTelemetry[Send Telemetry to<br/>Application Insights]
    TrackTelemetry --> OfferNewGame{Play<br/>Again?}

    OfferNewGame -->|Yes| InitGame
    OfferNewGame -->|No| End([Return to Main Menu])

    style Start fill:#e1f5ff
    style End fill:#ffe1e1
    style Player1Wins fill:#90EE90
    style Player2Wins fill:#90EE90
    style GameDraw fill:#FFD700
    style SaveStats fill:#FFA500
    style TrackTelemetry fill:#FFA500
